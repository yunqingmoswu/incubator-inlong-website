<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-1.1.0 plugin-docs plugin-id-default docs-doc-id-modules/tubemq/client_rpc">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.20">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Apache Inlong RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Apache Inlong Atom Feed">






<link rel="alternate" type="application/rss+xml" href="/news/rss.xml" title="Apache Inlong RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/news/atom.xml" title="Apache Inlong Atom Feed"><title data-rh="true">Client RPC | Apache Inlong</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://inlong.apache.org/docs/modules/tubemq/client_rpc"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="1.1.0"><meta data-rh="true" name="docusaurus_tag" content="docs-default-1.1.0"><meta data-rh="true" name="docsearch:version" content="1.1.0"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-1.1.0"><meta data-rh="true" property="og:title" content="Client RPC | Apache Inlong"><meta data-rh="true" name="description" content="1 General Introduction"><meta data-rh="true" property="og:description" content="1 General Introduction"><link data-rh="true" rel="icon" href="/img/logo.svg"><link data-rh="true" rel="canonical" href="https://inlong.apache.org/docs/modules/tubemq/client_rpc"><link data-rh="true" rel="alternate" href="https://inlong.apache.org/docs/modules/tubemq/client_rpc" hreflang="en"><link data-rh="true" rel="alternate" href="https://inlong.apache.org/zh-CN/docs/modules/tubemq/client_rpc" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://inlong.apache.org/docs/modules/tubemq/client_rpc" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.b502760d.css">
<link rel="preload" href="/assets/js/runtime~main.ac376975.js" as="script">
<link rel="preload" href="/assets/js/main.83ac32e4.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><div class="announcementBar_IbjG" style="background-color:#BBDFFF" role="banner"><div class="announcementBarPlaceholder_NC_W"></div><div class="announcementBarContent_KsVm">⭐️ &nbsp; If you like Apache InLong , give it a star on <a target="_blank" rel="noopener noreferrer" href="https://github.com/apache/incubator-inlong">GitHub</a></div><button type="button" class="clean-btn close announcementBarClose_FG1z" aria-label="Close"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Apache" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/logo.svg" alt="Apache" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">Apache InLong</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/">HOME</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/introduction">DOC</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/next/introduction">Next</a></li><li><a class="dropdown__link" href="/docs/introduction">1.1.0</a></li><li><a class="dropdown__link" href="/docs/1.0.0/introduction">1.0.0</a></li><li><a class="dropdown__link" href="/docs/0.12.0/introduction">0.12.0</a></li><li><a class="dropdown__link" href="/docs/0.11.0/user_guide/quick_start">0.11.0</a></li><li><a class="dropdown__link" href="/versions/">All versions</a></li></ul></div><a class="navbar__item navbar__link" href="/download/main">DOWNLOAD</a><a class="navbar__item navbar__link" href="/community/how-to-contribute">COMMUNITY</a><a class="navbar__item navbar__link" href="/blog">BLOG</a><a class="navbar__item navbar__link" href="/news">NEWS</a><a class="navbar__item navbar__link" href="/team">TEAM</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">ASF</a><ul class="dropdown__menu"><li><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Apache Software Foundation</a></li><li><a href="https://incubator.apache.org/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Apache Incubator</a></li><li><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="dropdown__link">License</a></li><li><a href="https://www.apache.org/events/current-event" target="_blank" rel="noopener noreferrer" class="dropdown__link">Events</a></li><li><a href="https://www.apache.org/security/" target="_blank" rel="noopener noreferrer" class="dropdown__link">Security</a></li><li><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Sponsorship</a></li><li><a href="https://www.apache.org/foundation/policies/privacy.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Privacy</a></li><li><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="dropdown__link">Thanks</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><span><svg t="1631348384596" class="iconLanguage_dNtB" viewBox="0 0 1024 1024" version="1.1" p-id="557" width="20" height="20"><path d="M547.797333 638.208l-104.405333-103.168 1.237333-1.28a720.170667 720.170667 0 0 0 152.490667-268.373333h120.448V183.082667h-287.744V100.906667H347.605333v82.218666H59.818667V265.386667h459.178666a648.234667 648.234667 0 0 1-130.304 219.946666 643.242667 643.242667 0 0 1-94.976-137.728H211.541333a722.048 722.048 0 0 0 122.453334 187.434667l-209.194667 206.378667 58.368 58.368 205.525333-205.525334 127.872 127.829334 31.232-83.84m231.424-208.426667h-82.218666l-184.96 493.312h82.218666l46.037334-123.306667h195.242666l46.464 123.306667h82.218667l-185.002667-493.312m-107.690666 287.744l66.56-178.005333 66.602666 178.005333z" fill="currentColor" p-id="558"></path></svg><span>English</span></span></a><ul class="dropdown__menu"><li><a href="/docs/modules/tubemq/client_rpc" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active">English</a></li><li><a href="/zh-CN/docs/modules/tubemq/client_rpc" target="_self" rel="noopener noreferrer" class="dropdown__link">简体中文</a></li></ul></div><a href="https://github.com/apache/incubator-inlong" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_S7eR colorModeToggle_vKtC"><button class="clean-btn toggleButton_rCf9 toggleButtonDisabled_Pu9x" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_RiAD"><nav class="menu thin-scrollbar menu_izAj menuWithAnnouncementBar_l2a_"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/introduction">InLong Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/design_and_concept/basic_concept">Design and Concept</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/quick_start/how_to_build">Quick Start</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/deployment/standalone">Deployment</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/modules/agent/overview">Components</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/modules/agent/overview">Agent</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/modules/dataproxy/overview">DataProxy</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/docs/modules/tubemq/overview">TubeMQ</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/modules/tubemq/overview">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/modules/tubemq/quick_start">Quick Start</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/modules/tubemq/producer_example">Producer Example</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/modules/tubemq/consumer_example">Consumer Example</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/modules/tubemq/tubemq-manager/overview">tubemq-manager</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/modules/tubemq/client_partition_assign_introduction">client partition assign</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/modules/tubemq/client_rpc">Client RPC</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/modules/tubemq/clients_java">TubeMQ JAVA SDK API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/modules/tubemq/configure_introduction">Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/modules/tubemq/console_introduction">Console Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/modules/tubemq/error_code">Error Code</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/modules/tubemq/http_access_api">HTTP API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/modules/tubemq/tubemq_metrics">TubeMQ Metrics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/modules/tubemq/tubemq_perf_test_vs_Kafka">TubeMQ VS Kafka</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/modules/sort/overview">Sort</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/modules/manager/overview">Manager</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/modules/dashboard/overview">Dashboard</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/modules/sort-standalone/overview">Sort Standalone</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/docs/modules/audit/overview">Audit</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/data_node/extract_node/auto_push">Data Nodes</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/sdk/dataproxy-sdk/example">SDK</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/user_guide/dashboard_usage">User Guide</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/development/inlong_msg">Development</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/administration/user_management">Administration</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/contact">Contact Us</a></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Xlws" aria-label="breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/">🏠</a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><span class="breadcrumbs__link" itemprop="item name">Components</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><span class="breadcrumbs__link" itemprop="item name">TubeMQ</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="item name">Client RPC</span><meta itemprop="position" content="3"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: 1.1.0</span><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Client RPC</h1></header><h2 class="anchor anchorWithStickyNavbar_mojV" id="1-general-introduction">1 General Introduction<a class="hash-link" href="#1-general-introduction" title="Direct link to heading">​</a></h2><p>Implements of this part can be found in <code>org.apache.tubemq.corerpc</code>. Each node in Apache TubeMQ Cluster Communicates by TCP Keep-Alive. Mseeages are definded using binary and protobuf combined.
<img loading="lazy" src="/assets/images/rpc_bytes_def-c8c63b21ec5ea017431db345384baa2d.png" width="1049" height="614" class="img_E7b_"></p><p>All we can see in TCP are binary streams. We defind a 4-byte msgToken message <code>RPC\_PROTOCOL\_BEGIN\_TOKEN</code> in header, which are used to distinguish each message and identify the legitimacy of the counterpart. When message client received is not started with these header field, client needs to close the connection and prompt the error and quit or reconnect because the protocal is not supported by TubeMQ or something wrong may happended. Follows is a 4-byte serialNo, this field is sent by client to server and returned by server exactly the same when after handling the request. It is mainly used to associate the context of the client request and response. And a 4-byte <code>listSize</code> field shows the number of data blocks in pb next, precisely the number of following <code>\&amp;lt;len\&amp;gt;\&amp;lt;data\&amp;gt;</code> blocks. This field would not be 0 in current definition. <code>\&amp;lt;len\&amp;gt;\&amp;lt;data\&amp;gt;</code> field is a combination of 2 filelds. That is, a length number and data, which mainly represents the length of this data block and the specific data.</p><p>We defined <code>listSize</code> as <code>\&amp;lt;len\&amp;gt;\&amp;lt;data\&amp;gt;</code> because serialized PB data is saved as a ByteBuffer object in TubeMQ, and in Java, there a maximum(8196) length of ByteBuffer block, an overlength PB message needs to be saved in several ByteBuffer. No total length was counted, and the ByteBuffer is directly written when Serializing in to TCP message.</p><p><strong>Pay more attention when implementing multiple languages and SDKs.</strong> Need to serialize PB data content into arrays of blocks(supported in PB codecs).</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="2-pb-format-code">2 PB format code:<a class="hash-link" href="#2-pb-format-code" title="Direct link to heading">​</a></h2><p>PB format encoding is divided into RPC framework definition, to the Master message encoding and to the Broker message encoding of three parts, you can use protobuf directly compiled to get different language codecs, it is very convenient to use.
<img loading="lazy" src="data:image/png;base64,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" width="386" height="115" class="img_E7b_"></p><p><code>RPC.proto</code> defines 6 struct, which divided into 2 class: Request message and Response message. Response message is divided into Successful Response and Exception Response.
<img loading="lazy" src="/assets/images/rpc_pbmsg_structure-3c30d7576240597353030eab2ce29254.png" width="1105" height="184" class="img_E7b_"></p><p>The request message encoding and response message decoding can be implemented in the <code>NettyClient.java</code> class. There is some room for improvement in this part of the definition and can be found in <a href="https://issues.apache.org/jira/browse/TUBEMQ-109" target="_blank" rel="noopener noreferrer">TUBEMQ-109</a>. However, due to compatibility concerns, it will be gradually replaced. We have implemented the current protobuf version, which is not a problem until at least 1.0.0. With the new protocol, the protocol implementation module requires each SDK to allow room for improvement. Take request message as an example, <code>RpcConnHeader</code> and other related structures are as follows：
<img loading="lazy" src="/assets/images/rpc_conn_detail-6f1124eef0ea4952a5fc00d9b28f3bf0.png" width="468" height="367" class="img_E7b_"></p><p>Flag marks whether the message is requested or not, and the next three marks represent the content of the message trace, which is not currently used; the related is a fixed mapping of the service type, protocol version, service type, etc., the more critical parameter RequestBody.timeout is the maximum allowable time from when a request is received by the server to when it is actually processed. Long wait time, discarded if exceeded, current default is 10 seconds, request filled as follows.
<img loading="lazy" src="/assets/images/rpc_header_fill-87f7c949336c12d0713a4c51c0f40e2a.png" width="1307" height="675" class="img_E7b_"></p><h2 class="anchor anchorWithStickyNavbar_mojV" id="3-interactive-diagram-of-the-clients-pb-request--response">3 Interactive diagram of the client&#x27;s PB request &amp; response：<a class="hash-link" href="#3-interactive-diagram-of-the-clients-pb-request--response" title="Direct link to heading">​</a></h2><p><strong>Producer Interaction</strong>：</p><p>The Producer has four pairs of instructions in the system, registration to master, heartbeat to master, exit from master and sending message to brokers.
<img loading="lazy" src="/assets/images/rpc_producer_diagram-ed4bb00e58a1ecec65f60f7c921b538c.png" width="974" height="694" class="img_E7b_"></p><p>Here we can see, Producer&#x27;s implementation logic is to get metadata such as the list of partitions of specified topic from master, then select a partition and send message via TCP connection according to the rules of the client. It may be unsafe to send message without registration to master, the initial consideration was to use internal intake messages as much as possible and after that, considering security issues, we added authorization information carrying on top of this to perform authentication and authorization checks on the server side, solving the situation where the client bypasses the direct connection to the master and sends messages without authorization. But this will only enable in production environment.</p><p><strong>Note in producer side of multiple languages implementation:</strong></p><ol><li><p>Our Master is running as a hot-swap master, and the switchover is based on the information carried by the <code>RspExceptionBody</code>. In this case, you need to search for the keywords <code>&amp;quot;StandbyException&amp;quot;</code>, If this type of exception occurs, switch to another Master node for re-registration. This part has some relevant issues to adjust to the problem.</p></li><li><p>Producer should re-register in the event of a Master connection failure during production, e.g. timeout, passive connection break, etc.</p></li><li><p>Producer side should pay attention to the Broker pre-connection operation in advance: the back-end cluster can have hundreds of Broker nodes, and each Broker has about  ten partitions, so there will be thousands of possible records about the partition, after the SDK receives the metadata information from the Master, it should perform the connection establishment operation on the Broker that has not yet built the chain in advance.</p></li><li><p>The Producer to Broker connection should be aware of anomaly detection and should be able to detect Broker bad spots and long periods of no messages, and to recycle the connection to Broker to avoid unstable operation in long-term running scene.</p></li></ol><p><strong>Consumer Interaction Diagram</strong>:</p><p>Consumer has 7 pairs of command in all, Register, Heartbeat, Exit to Master; Register, Logout, Heartbeat, Pulling mseeage to Broker. Registration and Logout to Broker is the same command, indicated by a different status code.</p><p><img loading="lazy" src="/assets/images/rpc_consumer_diagram-048bd92863ee20cdf21f684cef98258f.png" width="990" height="694" class="img_E7b_"></p><p>As we can see from the above picture, the Consumer first has to register to the Master, but registering to the Master can not get Metadata information immediately because TubeMQ is using a server-side load-balancing model, and the client needs to wait for the server to dispatch the consumption partition information; Consumer to Broker needs to register the logout operation. Partition is exclusive at the time of consumption, i.e., the same partition can only be consumed by one consumer in the same group at the same time. To solve this problem, the client needs to register and get consumption access to the partition; message pull and consumption confirmation need to appear in pairs. Although the protocol supports multiple pulls and then the last acknowledgement process, it is possible that the consumer permissions of a partition may be lost timeout from the client, thus This causes the data rollback to be triggered by repetitive consumption, and the more data is saved the more repetitive consumption will occur, so follow the 1:1 submission comparison fit.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="4-client-feature">4 Client feature:<a class="hash-link" href="#4-client-feature" title="Direct link to heading">​</a></h2><table><thead><tr><th><strong>FEATURE</strong></th><th><strong>Java</strong></th><th><strong>C/C++</strong></th><th><strong>Go</strong></th><th><strong>Python</strong></th><th><strong>Rust</strong></th><th><strong>NOTE</strong></th></tr></thead><tbody><tr><td>TLS</td><td>✅</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>Authorization</td><td>✅</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>Anti-bypass-master production/consumption</td><td>✅</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>Distributed system with clients accessing Broker without Master&#x27;s authentication authorization</td><td>✅</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>Effectively-Once</td><td>✅</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>Partition offset consumption</td><td>✅</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>Multiple Topic Consumption for a single Consumer group</td><td>✅</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>Server Consumption filter</td><td>✅</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>Auto shielding inactive Nodes</td><td>✅</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>Auto shielding bad Brokers</td><td>✅</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>Auto reconnect</td><td>✅</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>Auto recycling of Idle Connection</td><td>✅</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>Inactive for more than a specified period(e.g. 3min, mainly the producer side)</td><td>✅</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>Connection reuse</td><td>✅</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>Connection sharing according to the sessionFactory</td><td>✅</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>Unconnection reuse</td><td>✅</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>Asynchrounous Production</td><td>✅</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>Synchrounous Production</td><td>✅</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>Pull Consumption</td><td>✅</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>Push Consumption</td><td>✅</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>Consumption limit (QOS)</td><td>✅</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>Limit the amount of data per unit of time consumed by consumers</td><td>✅</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>Pull Consumption frequency limit</td><td>✅</td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>Consumer Pull Consumption frequency limit</td><td>✅</td><td></td><td></td><td></td><td></td><td></td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_mojV" id="5-client-function-induction-casebycase">5 Client function Induction CaseByCase：<a class="hash-link" href="#5-client-function-induction-casebycase" title="Direct link to heading">​</a></h2><p><strong>Client side and server side RPC interaction process</strong>：</p><hr><p><img loading="lazy" src="/assets/images/rpc_inner_structure-3438098f8c404d1bbf3876abb80db693.png" width="729" height="449" class="img_E7b_"></p><p>As shown above, the client has to maintain local preservation of the sent request message until the RPC times out, or a response message is received and the response The message is associated by the SerialNo generated when the request is sent; the Broker information received from the server side, and the Topic information, which the SDK stores locally and updates with the latest returned information, as well as periodic reports to the Server side; the SDK is maintained to the heartbeat of the Master or Broker, and if Master feedback is found When the registration timeout error, re-registration operation should be carried out; SDK should be based on Broker connection establishment, the same process different Between objects, to allow the business to choose whether to support per-object or per-process connections.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="51-message-producer-register-to-master">5.1 Message: Producer register to Master:<a class="hash-link" href="#51-message-producer-register-to-master" title="Direct link to heading">​</a></h3><hr><p><img loading="lazy" src="/assets/images/rpc_producer_register2M-68555a33e67cd6fe04901fba68ec96ce.png" width="708" height="374" class="img_E7b_"></p><p><strong>ClientId</strong>：Producer needs to construct a ClientId at startup, and the current construction rule is: </p><p>Java: ClientId = IPV4 + <code>&amp;quot;-&amp;quot;</code> + Thread ID + <code>&amp;quot;-&amp;quot;</code> + createTime + <code>&amp;quot;-&amp;quot;</code> + Instance ID + <code>&amp;quot;-&amp;quot;</code> + Client Version ID <!-- -->[+ <code>&amp;quot;-&amp;quot;</code> + SDK]<!-- -->. it is recommended that other languages add the above markup for easier access to the issue Exclusion. The ID value is valid for the lifetime of the Producer.</p><p><strong>TopicList</strong>: The list of topics published by the user, Producer provides the initial list of topics for the data to be published at initialization, and also allows the business to defer adding new topics via the publish function in runtime, but does not support reducing topics in runtime.</p><p><strong>brokerCheckSum</strong>: The check value of the Broker metadata information stored locally by the client, which is not available locally in Producer at initial startup, takes the value as -1; the SDK needs to carry the last BrokerCheckSum value on each request, and the Master determines whether the client&#x27;s metadata needs to be updated by comparing the value.</p><p><strong>hostname</strong>: The IPV4 address value of the machine where the Producer is located.</p><p><strong>success</strong>: Whether the operation is successful, success is true, failure is false.</p><p><strong>errCode</strong>: The code of error, currently one error code represents a large class of error, the specific cause of the error needs to be specifically identified by <code>errMsg</code>.</p><p><strong>errMsg</strong>: The specific error message that the SDK needs to print out if something goes wrong.</p><p><strong>authInfo</strong>：Authentication authorization information, if the user configuration is filled in to start authentication processing, then fill in; if authentication is required, then report according to the signature of the user name and password; if it is running, such as heartbeat, if the Master forces authentication processing, then report according to the signature of the user name and password; if not, then authenticate according to the authorization Token provided by the Master during the previous interaction; this authorization Token is also used to carry the message to Broker during production.</p><p><strong>brokerInfos</strong>: Broker metadata information, which is primarily a list of Broker information for the entire cluster that the Master feeds back to the Producer in this field; the format is as follows.</p><p><img loading="lazy" src="/assets/images/rpc_broker_info-9230683b0b73f96ba8a91b4953ac0698.png" width="616" height="292" class="img_E7b_"></p><p><strong>authorizedInfo</strong>: Master provides authorization information in the following format.</p><p><img loading="lazy" src="data:image/png;base64,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" width="497" height="113" class="img_E7b_"></p><p><strong>visitAuthorizedToken</strong>: To prevent clients from bypassing the Master&#x27;s access authorization token, if that data is available, the SDK should save it locally and carry that information on subsequent visits to the Broker; if the field is changed on subsequent heartbeats, the locally cached data for that field needs to be updated.</p><p><strong>authAuthorizedToken</strong>：Authenticated authorization tokens, if they have data for that field, they need to save and carry that field information for subsequent accesses to the Master and Broker; if the field is changed on subsequent heartbeats, the local cache of that field data needs to be updated.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="52-mseeage-heartbeat-from-producer-to-master">5.2 Mseeage: Heartbeat from Producer to Master:<a class="hash-link" href="#52-mseeage-heartbeat-from-producer-to-master" title="Direct link to heading">​</a></h3><hr><p><img loading="lazy" src="/assets/images/rpc_producer_heartbeat2M-d06fdbaf4a2fffc38f06ed8e8cb2a42a.png" width="601" height="431" class="img_E7b_"></p><p><strong>topicInfos</strong>: The metadata information corresponding to the Topic published by the SDK, including partition information and the Broker where it is located, is decoded. Since there is a lot of metadata, the outflow generated by passing the object data through as is would be very large, so we made Improvements.</p><p><img loading="lazy" src="/assets/images/rpc_convert_topicinfo-a8f6cd8b318369300b02be64bc666cfb.png" width="862" height="547" class="img_E7b_"></p><p><strong>requireAuth</strong>: Code to indicates the expiration of the previous authAuthorizedToken of the Master, requiring the SDK to report the username and password signatures on the next request.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="53-message-producer-exits-from-master">5.3 Message: Producer exits from Master:<a class="hash-link" href="#53-message-producer-exits-from-master" title="Direct link to heading">​</a></h3><hr><p><img loading="lazy" src="/assets/images/rpc_producer_close2M-23052167580ee7d97e20b88ef526e84f.png" width="571" height="253" class="img_E7b_"></p><p>Note that if authentication is enable, closing operation will do the authentication to avoid external interference with the operation.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="54-message-producer-to-broker">5.4 Message: Producer to Broker:<a class="hash-link" href="#54-message-producer-to-broker" title="Direct link to heading">​</a></h3><hr><p>This part is related to the definition of RPC Message.</p><p><img loading="lazy" src="/assets/images/rpc_producer_sendmsg2B-9f5922ab7f0800efd9d9432b584275a9.png" width="538" height="431" class="img_E7b_"></p><p><strong>Data</strong> is the binary byte stream of Message.</p><p><img loading="lazy" src="/assets/images/rpc_message_data-0de75b17b5dc86e8e26041750133c10e.png" width="684" height="327" class="img_E7b_"></p><p><strong>sentAddr</strong> is the local IPv4 address of the machine where the SDK is located converted to a 32-bit numeric ID.</p><p><strong>msgType</strong> is the type of filter message. <code>msgTime</code> is the message time when the SDK sends a message, its value comes from the value filled in by <code>putSystemHeader</code> when constructing Message, and there is a corresponding API in Message to get it.</p><p><strong>requireAuth</strong>: Required authentication operations to Broker for data production, not currently in effect due to performance issues. The authAuthorizedToken value in the sent message is based on the value provided by the Master and will change with the change of the Master.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="55-partition-loadbalance">5.5 Partition Loadbalance:<a class="hash-link" href="#55-partition-loadbalance" title="Direct link to heading">​</a></h3><hr><p>Apache TubeMQ currently uses a server-side load balancing mode, where the balancing process is managed and maintained by the server; subsequent versions will add a client-side load balancing mode, so that two modes can co-exist.</p><p><strong>Server side load balancing</strong>:</p><ul><li>When the Master process starts, it starts the load-balancing thread balancerChore. balancerChore periodically checks the current registered consumer group for load balancing. The process is simply to evenly distribute the consumer group subscription partitions to registered clients, and periodically detect the current partition of the client If so, the extra partitions will be split to other clients with less number of subscriptions. First, the master checks if the current consumer group needs load balancing. The topic collection is sorted by all partitions of the topic, and all consumer IDs of this consumer group, and then by the consumer group&#x27;s all Divide and model the number of partitions and the number of clients to get the number of partitions each client subscribes to at most; then give each client the Assign partitions and carry the partition information in the heartbeat response when the consumer subscribes; if the client has more than one partition currently in place Give the client a partition release command to partition the partition away from the consumer, and to the assigned consumer A partition assignment instruction that informs that the partition is assigned to the corresponding client is as follows.</li></ul><p>Translated with <a href="http://www.DeepL.com/Translator" target="_blank" rel="noopener noreferrer">www.DeepL.com/Translator</a> (free version)</p><p><img loading="lazy" src="/assets/images/rpc_event_proto-50409e0571ebb4e0ff39152051392f2f.png" width="630" height="171" class="img_E7b_"></p><p><strong>rebalanceId</strong>：A long-type auto-increment number that indicates the round of load balance.</p><p><strong>opType</strong>：Operation code, and its value defined in EventType. There are only four parts of the opcode that have been implemented, as follows: <code>DISCONNECT</code>, <code>CONNECT</code>, <code>REPORT</code> and <code>ONLY_</code>. Opcode started with <code>ONLY</code> is not detailed developed.</p><p><img loading="lazy" src="/assets/images/rpc_event_proto_optype-ae562eda2da54ded1f6a1d32c51ffe46.png" width="897" height="737" class="img_E7b_"></p><p><strong>status</strong>：Defined in <code>EventStatus</code>, indicates the status of the event. When Master constructs a load balancing task, it sets the status to <code>TODO</code>. When receiving the client heartbeat request, master writes the task to the response message and sets the status to <code>PROCESSING</code>. The client receives a load balancing command from the heartbeat response, and then it can perform the actual connection or disconnection operation, after the operation is finished, set the command status to <code>DONE</code> until sending next heartbeat to master.</p><p><img loading="lazy" src="/assets/images/rpc_event_proto_status-9c22e50e09e08c51f98670a964f434fe.png" width="1000" height="624" class="img_E7b_"></p><p><strong>subscribeInfo</strong> indicates assigned partition information, in the format suggested by the comment.</p><ul><li>Consumer Operation: When consumer receives metadata returned from master, it should establish the connection and release the operation(Refer to the opType note above). When connection established, return the operation result to master so that consumer can receive some relative job and perform. What we need to know is the LoadBalance of registration is a best-effort operation, if a new consumer send a request for connection before the consumer who occupanies the partition quits, it will receive <code>PARTITION\_OCCUPIED</code> exception response. And at this time partition tries to remove it from its queue. And partition consumer will also remove it when receiving corresponding response so that the consumer could successfully register to this partition in next load balance.</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/apache/incubator-inlong-website/edit/master/versioned_docs/version-1.1.0/modules/tubemq/client_rpc.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/modules/tubemq/client_partition_assign_introduction"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">client partition assign</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/modules/tubemq/clients_java"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">TubeMQ JAVA SDK API</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-general-introduction" class="table-of-contents__link toc-highlight">1 General Introduction</a></li><li><a href="#2-pb-format-code" class="table-of-contents__link toc-highlight">2 PB format code:</a></li><li><a href="#3-interactive-diagram-of-the-clients-pb-request--response" class="table-of-contents__link toc-highlight">3 Interactive diagram of the client&#39;s PB request &amp; response：</a></li><li><a href="#4-client-feature" class="table-of-contents__link toc-highlight">4 Client feature:</a></li><li><a href="#5-client-function-induction-casebycase" class="table-of-contents__link toc-highlight">5 Client function Induction CaseByCase：</a><ul><li><a href="#51-message-producer-register-to-master" class="table-of-contents__link toc-highlight">5.1 Message: Producer register to Master:</a></li><li><a href="#52-mseeage-heartbeat-from-producer-to-master" class="table-of-contents__link toc-highlight">5.2 Mseeage: Heartbeat from Producer to Master:</a></li><li><a href="#53-message-producer-exits-from-master" class="table-of-contents__link toc-highlight">5.3 Message: Producer exits from Master:</a></li><li><a href="#54-message-producer-to-broker" class="table-of-contents__link toc-highlight">5.4 Message: Producer to Broker:</a></li><li><a href="#55-partition-loadbalance" class="table-of-contents__link toc-highlight">5.5 Partition Loadbalance:</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://inlong.apache.org" target="_blank" rel="noopener noreferrer" class="footerLogoLink_gHmE"><img src="/img/incubator-logo.svg" alt="Apache Inlong" class="themedImage_W2Cr themedImage--light_TfLj footer__logo"><img src="/img/incubator-logo.svg" alt="Apache Inlong" class="themedImage_W2Cr themedImage--dark_oUvU footer__logo"></a></div><div class="footer__copyright"><div style="text-align: left;">
          <div>
            <p style="font-family: Avenir-Medium;font-size: 14px;color: #999;line-height: 20px;"> Apache InLong is an effort undergoing incubation at The Apache Software Foundation (ASF), sponsored by the Apache Incubator. Incubation is required of all newly accepted projects until a further review indicates that the infrastructure, communications, and decision making process have stabilized in a manner consistent with other successful ASF projects. While incubation status is not necessarily a reflection of the completeness or stability of the code, it does indicate that the project has yet to be fully endorsed by the ASF. </p>
          </div>
          <div style="border-top: 1px solid #ccc;min-height: 60px;line-height: 20px;text-align: center;font-family: Avenir-Medium;font-size: 14px;color: #999;display: flex;align-items: center;"><span>Copyright © 2019-2022 The Apache Software Foundation. Apache InLong, InLong, and its feather logo are trademarks of The Apache Software Foundation.</span></div>
        </div></div></div></div></footer></div>
<script src="/assets/js/runtime~main.ac376975.js"></script>
<script src="/assets/js/main.83ac32e4.js"></script>
</body>
</html>